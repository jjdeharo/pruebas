<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Aplicaciones de Google Drive</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; box-sizing: border-box; }
        .container-msg { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background-color: #f0f2f5; }
        .message { text-align: center; padding: 40px; background-color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 90%; }
        h1 { color: #333; font-size: 1.5em; margin-bottom: 10px; }
        p { color: #666; }
        iframe { width: 100%; height: 100%; border: none; display: none; }
        #progressContainer { margin-top: 20px; overflow: hidden; }
        .progress-bar { width: 100%; height: 4px; background-color: #e9ecef; border-radius: 4px; }
        .progress-bar-inner { width: 50%; height: 100%; background-color: #0d6efd; animation: progress-animation 2s linear infinite; }
        @keyframes progress-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
    </style>
</head>
<body>
    <iframe id="viewerFrame"></iframe>
    <div id="messageContainer" class="container-msg">
        <div class="message">
            <h1 id="messageTitle">Cargando aplicación...</h1>
            <p id="messageText">Estableciendo conexión con Google Drive.</p>
            <div id="progressContainer">
                <div class="progress-bar"><div class="progress-bar-inner"></div></div>
            </div>
        </div>
    </div>
    
    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxgHrkyhcO01HnuX0uil9M7f5MDE5LXr56G4P1_4PcT82k9zpxSih8IHuedB7mcT9X4/exec';
        window.onload = function() {
            const folderId = window.location.hash.substring(1);
            const msgContainer = document.getElementById('messageContainer');
            const msgTitle = document.getElementById('messageTitle');
            const msgText = document.getElementById('messageText');
            const viewerFrame = document.getElementById('viewerFrame');
            const progressContainer = document.getElementById('progressContainer');

            if (!folderId) {
                msgTitle.textContent = 'Bienvenido al Visor';
                msgText.innerHTML = 'Para usarlo, comparte una carpeta de Drive, copia su ID y añádelo a la URL después de una almohadilla (#).<br><strong>Ejemplo: .../index.html#ID_DE_LA_CARPETA</strong>';
                progressContainer.style.display = 'none';
                return;
            }

            fetch(`${APPS_SCRIPT_URL}?folderId=${folderId}`)
                .then(r => {
                    if (!r.ok) return Promise.reject('Error de red. Revisa la configuración del despliegue de la API y los permisos de la carpeta.');
                    return r.json();
                })
                .then(data => {
                    if (data.error) throw new Error(data.details || data.error);
                    const html = data['index.html'] || '';
                    const css = data['styles.css'] || data['style.css'] || '';
                    const js = data['app.js'] || data['script.js'] || '';
                    const iframeContent = '<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>' + css + '</style></head><body>' + html + '<script>' + js + '<' + '/script></body></html>';
                    viewerFrame.srcdoc = iframeContent;
                    msgContainer.style.display = 'none';
                    viewerFrame.style.display = 'block';
                })
                .catch(err => {
                    msgTitle.textContent = 'Error al Cargar';
                    msgText.textContent = 'Razón: ' + err.message;
                    progressContainer.style.display = 'none';
                });
        };
        </script>
</body>
</html>