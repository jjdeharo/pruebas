<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BoardLive</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="stylesheet" href="styles.css" />
  <!-- PeerJS + QR + jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header data-collapsed="false">
      <button id="menuToggle" class="btn menu-toggle" type="button" aria-expanded="true" aria-controls="toolbarControls">Ocultar men√∫</button>
      <div class="toolbar-nav" role="tablist" aria-label="Secciones de la herramienta">
        <button class="btn tab-btn" type="button" data-target="session" role="tab" aria-controls="section-session">Sesi√≥n</button>
        <button class="btn tab-btn" type="button" data-target="draw" role="tab" aria-controls="section-draw">Dibujo</button>
        <button class="btn tab-btn" type="button" data-target="options" role="tab" aria-controls="section-options">Archivo</button>
      </div>
      <div id="toolbarControls" class="toolbar-controls" data-active="session">
        <div id="section-session" class="toolbar-section" data-section="session" role="tabpanel" aria-label="Controles de sesi√≥n">
          <strong id="roleLabel">Modo:</strong>
          <button id="hostBtn" class="btn host-only" data-state="idle">üñ•Ô∏è Compartir mi pizarra</button>
          <label id="codeWrapper">C√≥digo <input id="code" type="text" placeholder="ABC123" style="width:7rem;text-transform:uppercase"/></label>
          <button id="joinBtn" class="btn" data-state="idle">üë• Unirme a una pizarra</button>
          <button id="qrBtn" class="btn host-only" title="Invitar a tu pizarra">Invitar</button>
        </div>
        <div id="section-draw" class="toolbar-section" data-section="draw" role="tabpanel" aria-label="Herramientas de dibujo">
          <div class="draw-toolbar edit-only" role="group" aria-label="Controles principales de dibujo">
            <div class="draw-toolbar-actions">
              <button id="toolSettingsToggle" class="btn tool-trigger" type="button" aria-expanded="false" aria-controls="toolSettingsPanel" title="Seleccionar herramienta">‚úèÔ∏è Trazo libre</button>
              <button id="eraser" class="btn" type="button">Borrador</button>
              <button id="clear" class="btn" type="button">Limpiar</button>
              <div class="draw-toolbar-divider" aria-hidden="true"></div>
              <button id="undo" class="btn" type="button" title="Deshacer √∫ltimo trazo">‚Ü©Ô∏è Deshacer</button>
              <button id="redo" class="btn" type="button" title="Rehacer">‚Ü™Ô∏è Rehacer</button>
              <button id="insertImage" class="btn host-only" type="button" title="Insertar imagen">üñºÔ∏è Imagen</button>
            </div>
          </div>
        </div>
        <div id="section-options" class="toolbar-section" data-section="options" role="tabpanel" aria-label="Otras opciones">
          <button id="openImage" class="btn host-only btn-with-icon" type="button" title="Abrir una imagen y a√±adirla a la pizarra">
            <span class="btn-icon" aria-hidden="true">üñºÔ∏è</span>
            <span>Abrir imagen</span>
          </button>
          <button id="openPdf" class="btn host-only btn-with-icon" type="button" title="Abrir un PDF y a√±adir sus p√°ginas">
            <span class="btn-icon" aria-hidden="true">üìÑ</span>
            <span>Abrir PDF</span>
          </button>
          <button id="savePdf" class="btn host-only btn-with-icon" title="Guardar como PDF">
            <span class="btn-icon" aria-hidden="true">üíæ</span>
            <span>Guardar PDF</span>
          </button>
        </div>
        <input id="pdfInput" class="host-only" type="file" accept="application/pdf" style="display:none" />
        <input id="imageInput" class="host-only" type="file" accept="image/*" style="display:none" />
      </div>
      <div class="header-pages">
        <button id="pageToggle" class="btn edit-only" type="button" aria-expanded="false" aria-controls="pagePanel" title="Mostrar p√°ginas">üóÇÔ∏è P√°ginas</button>
      </div>
      <div class="header-status">
        <div id="status" class="status-indicator" data-state="disconnected">
          <button id="statusToggle" class="btn status-btn" type="button" aria-haspopup="true" aria-expanded="false" title="Ver conexiones">
            <span id="statusText">sin conexi√≥n</span>
          </button>
        </div>
        <button id="viewToggle" class="btn view-toggle" type="button" aria-pressed="false" title="Maximizar √°rea de dibujo">‚õ∂ Maximizar</button>
      </div>
    </header>
    <div id="toolSettingsPanel" class="tool-settings-popover edit-only" aria-live="polite" data-open="false" aria-hidden="true">
      <div class="tool-settings-head">
        <div class="tool-settings-heading">
          <strong id="toolSettingsTitle">Trazo libre</strong>
          <span id="toolSettingsHint">Ajusta las propiedades de la herramienta seleccionada</span>
        </div>
        <div class="tool-settings-actions">
          <button id="toolSettingsReset" class="btn icon-btn" type="button" aria-label="Restaurar ajustes de herramientas" title="Restaurar ajustes de herramientas">‚Ü∫</button>
          <button id="toolSettingsPin" class="btn icon-btn" type="button" aria-pressed="false" aria-label="Fijar panel de herramientas">üìå</button>
          <button id="toolSettingsClose" class="btn icon-btn" type="button" aria-label="Cerrar ajustes">‚úï</button>
        </div>
      </div>
      <div class="tool-settings-tabs" role="tablist" aria-label="Herramientas disponibles">
        <button class="btn tool-btn" type="button" data-tool="pen" aria-selected="true" title="Trazo libre">‚úèÔ∏è Trazo</button>
        <button class="btn tool-btn" type="button" data-tool="line" aria-selected="false" title="Dibujar l√≠nea recta">‚ûñ L√≠nea</button>
        <button class="btn tool-btn" type="button" data-tool="rect" aria-selected="false" title="Dibujar rect√°ngulo">‚¨õ Rect√°ngulo</button>
        <button class="btn tool-btn" type="button" data-tool="ellipse" aria-selected="false" title="Dibujar c√≠rculo o elipse">‚ö™ C√≠rculo</button>
        <button class="btn tool-btn" type="button" data-tool="highlight" aria-selected="false" title="Resaltador semitransparente">üü° Resaltador</button>
        <button class="btn tool-btn" type="button" data-tool="eraser" aria-selected="false" title="Borrador">üßΩ Borrador</button>
        <button class="btn tool-tab host-only" type="button" data-tab="page" aria-selected="false" title="Opciones de la p√°gina">üìÑ P√°gina</button>
      </div>
      <div class="tool-settings-content">
        <div class="tool-settings-grid" data-pane="tool">
          <label class="tool-setting" data-field="stroke" for="color">
            <span id="strokeLabel">Color del trazo</span>
            <input id="color" type="color" value="#000000" />
          </label>
          <label class="tool-setting" data-field="size" for="size">
            <span id="sizeLabel">Grosor (px)</span>
            <input id="size" type="number" min="1" max="100" value="4" />
          </label>
          <label class="tool-setting" data-field="fill" id="fillSetting" for="shapeFill" hidden>
            <span id="fillLabel">Relleno</span>
            <div class="fill-input-group">
              <input id="shapeFill" type="color" value="#ffffff" />
              <label class="fill-transparent-toggle">
                <input id="shapeFillTransparent" type="checkbox" />
                <span>Sin relleno</span>
              </label>
            </div>
          </label>
          <label class="tool-setting" data-field="eraser" for="eraserSize" hidden>
            <span>Grosor borrador</span>
            <input id="eraserSize" type="number" min="1" max="100" value="20" />
          </label>
        </div>
        <div class="tool-settings-grid host-only" data-pane="page" hidden>
          <label class="tool-setting" data-field="bgPreset" for="bgPreset">
            <span>Tipo de fondo</span>
            <select id="bgPreset"></select>
          </label>
          <label class="tool-setting" data-field="bg" for="bg">
            <span>Color del fondo</span>
            <input id="bg" type="color" value="#ffffff" />
          </label>
        </div>
      </div>
    </div>
    <div class="board" id="board">
      <canvas id="canvas" style="height: calc(100vh - 56px);"></canvas>
      <div id="eraserCursor" aria-hidden="true"></div>
      <button id="boardRestoreBtn" class="board-restore-btn" type="button" aria-label="Restaurar vista" title="Restaurar vista" hidden></button>
    </div>
  </div>
  <div id="pagePanel" class="page-panel edit-only" role="dialog" aria-modal="false" aria-label="P√°ginas de la pizarra" hidden>
    <div class="page-panel-head">
      <strong>P√°ginas</strong>
      <button id="pageClose" class="btn" type="button" title="Ocultar panel">Cerrar</button>
    </div>
    <div class="page-tools">
      <button id="pagePrev" class="btn" type="button" title="P√°gina anterior">‚óÄ</button>
      <button id="pageNext" class="btn" type="button" title="P√°gina siguiente">‚ñ∂</button>
      <button id="pageAdd" class="btn" type="button" title="A√±adir una p√°gina nueva">‚ûï A√±adir</button>
    </div>
    <div id="pageThumbnails" class="page-thumbnails" role="listbox" aria-label="Miniaturas de p√°ginas"></div>
  </div>

  <div id="guestPanel" class="guest-panel" role="dialog" aria-modal="false" aria-labelledby="guestPanelTitle" hidden>
    <div class="guest-panel-head">
      <strong id="guestPanelTitle">Conexiones</strong>
      <div class="guest-panel-actions">
        <button id="guestPanelClose" class="btn icon-btn" type="button" aria-label="Cerrar panel de invitados">‚úï</button>
      </div>
    </div>
    <div id="guestHostView" class="guest-panel-body" hidden>
      <label class="guest-toggle-all">
        <input id="guestAllowAll" type="checkbox" />
        <span>Permitir que todos dibujen</span>
      </label>
      <div id="guestList" class="guest-list" role="group" aria-label="Invitados conectados"></div>
      <p id="guestEmpty" class="guest-empty" hidden>Sin invitados conectados.</p>
    </div>
    <div id="guestSelfView" class="guest-panel-body" hidden>
      <label class="guest-self-field">
        <span>Mi nombre</span>
        <input id="guestSelfName" type="text" maxlength="48" placeholder="Escribe tu nombre" />
      </label>
      <button id="guestRequestBtn" class="btn guest-request-btn" type="button">Pedir permiso para dibujar</button>
      <p id="guestRequestHint" class="guest-request-hint">Actualmente est√°s en modo lectura.</p>
    </div>
  </div>

  <!-- QR modal -->
  <div class="qr-overlay" id="qrOverlay" role="dialog" aria-modal="true">
    <div class="qr-card">
      <div class="qr-head">
        <strong>Con√©ctate a esta pizarra</strong>
        <button id="qrClose" class="btn">Cerrar</button>
      </div>
      <div class="qr-box"><div id="qr"></div></div>
      <div class="qr-meta">
        <div>Abre esta URL y usa el c√≥digo <span class="kbd" id="qrCodeText">‚Äî</span></div>
        <button id="copyUrlBtn" class="btn copy-btn host-only" type="button">Copiar enlace</button>
        <div id="qrUrl" class="qr-url host-only" title="Haz clic para copiar" role="button" tabindex="-1" aria-disabled="true">‚Äî</div>
        <div id="copyUrlFeedback" class="copy-feedback hidden" aria-live="polite">Enlace copiado</div>
      </div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>

</body>
</html>
